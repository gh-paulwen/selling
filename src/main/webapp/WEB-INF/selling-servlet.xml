<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
 http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
 http://www.springframework.org/schema/mvc
 http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
 http://www.springframework.org/schema/context
 http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<!-- 默认扫描controller包 -->
	<context:component-scan base-package="com.zhklong.selling.controller" />
	<!-- 配置页面路径 -->
	<bean
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/jsp/" />
		<property name="suffix" value=".jsp" />
	</bean>
	<!-- 配置静态资源路径 -->
	<mvc:resources location="/WEB-INF/static/" mapping="/**" />
	<!-- 配置注解驱动 -->
	<mvc:annotation-driven />
	<!-- 配置jdbc配置文件路径 -->
	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:jdbc.properties</value>
				<value>classpath:sms.properties</value>
			</list>
		</property>
	</bean>
	<!-- 配置数据库连接池 -->
	<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
		<property name="driverClass" value="${driverClass}" />
		<property name="jdbcUrl" value="${url}" />
		<property name="user" value="${username}" />
		<property name="password" value="${password}" />
		<property name="maxPoolSize" value="${maxPoolSize}" />
		<property name="maxIdleTime" value="${maxIdleTime}" />
	</bean>
	<!-- SessionFactory -->
	<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="configLocation" value="classpath:mybatisConfig.xml" />
	</bean>
	<!-- 配置mapper路径和sqlSessionFactory -->
	<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
		<property name="basePackage" value="com.zhklong.selling.mapper" />
		<property name="sqlSessionFactoryBeanName" value="sqlSessionFactory" />
	</bean>
	<!-- 配置文件上传 -->
	<bean id="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<property name="defaultEncoding" value="utf-8" />
		<property name="maxUploadSize" value="10485760" />
		<property name="maxInMemorySize" value="4096" />
	</bean>
	
	<!-- 拦截器 -->
	<mvc:interceptors>
	  <bean class="com.zhklong.selling.interceptor.GlobalInterceptor"/>
	  
	  <!--  
	  <mvc:interceptor>
	  	<mvc:mapping path="/employee/getAll"/>
	  	<bean class="com.zhklong.selling.interceptor.SystemAdminInterceptor"/>
	  </mvc:interceptor>
	  <mvc:interceptor>
	  	<mvc:mapping path="com.zhklong.selling.interceptor.CompanyAdminInterceptor"/>
	  	<bean class=""/>
	  </mvc:interceptor>
	  <mvc:interceptor>
	  	<mvc:mapping path="com.zhklong.selling.interceptor.StoreAdminInterceptor"/>
	  	<bean class=""/>
	  </mvc:interceptor>
	  <mvc:interceptor>
	  	<mvc:mapping path="com.zhklong.selling.interceptor.StorageAdminInterceptor"/>
	  	<bean class=""/>
	  </mvc:interceptor>
	  <mvc:interceptor>
	  	<mvc:mapping path="com.zhklong.selling.interceptor.SalesmanInterceptor"/>
	  	<bean class=""/>
	  </mvc:interceptor>
	  <mvc:interceptor>
	  	<mvc:mapping path="/employee/getAll"/>
	  	<bean class="com.zhklong.selling.interceptor.LastInterceptor"/>
	  </mvc:interceptor>
	  
	  -->
	</mvc:interceptors>
	

	<!-- Mapper -->
	<bean id="employeeMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.EmployeeMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	<bean id="employeeTypeMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.EmployeeTypeMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	<bean id="functionalityMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.FunctionalityMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	<bean id="companyMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.CompanyMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	<bean id="storeMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.StoreMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	<bean id="companyTypeMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.CompanyTypeMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	<bean id="cityMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface" value="com.zhklong.selling.mapper.CityMapper" />
		<property name="sqlSessionFactory" ref="sqlSessionFactory" />
	</bean>
	
	
	<!-- Util -->
	<bean id="smsUtil" class="com.zhklong.selling.util.SMSUtil">
	   	<property name="signName" value="${signName}"/>
	   	<property name="template" value="${template}"/>
	   	<property name="access" value="${access}"/>
	   	<property name="secret" value="${secret}"/>
	</bean>
	<bean id="imageVerifyCodeUtil" class="com.zhklong.selling.util.ImageVerifyCodeUtil"/>

	<!-- Service -->
	<bean id="employeeService" class="com.zhklong.selling.service.impl.EmployeeService">
		<property name="employeeMapper" ref="employeeMapper" />
		<property name="employeeTypeMapper" ref="employeeTypeMapper"/>
		<property name="functionalityMapper" ref="functionalityMapper"/>
		<property name="smsUtil" ref="smsUtil"/>
	</bean>
	<bean id="storeService" class="com.zhklong.selling.service.impl.StoreService">
		<property name="storeMapper" ref="storeMapper"/>
	</bean>
	<bean id="companyService" class="com.zhklong.selling.service.impl.CompanyService">
		<property name="companyMapper" ref="companyMapper"/>
		<property name="companyTypeMapper" ref="companyTypeMapper"/>
	</bean>
	<bean id="cityService" class="com.zhklong.selling.service.impl.CityService">
		<property name="cityMapper" ref="cityMapper"/>
	</bean>

	<!-- Controller -->
	<bean id="employeeController" class="com.zhklong.selling.controller.EmployeeController">
		<property name="employeeService" ref="employeeService" />
		<property name="imageVerifyCodeUtil" ref="imageVerifyCodeUtil"/>
	</bean>
	<bean id="storeController" class="com.zhklong.selling.controller.StoreController">
		<property name="storeService" ref="storeService"/>
	</bean>
	<bean id="companyController" class="com.zhklong.selling.controller.CompanyController">
		<property name="companyService" ref="companyService"/>
	</bean>
	<bean id="cityController" class="com.zhklong.selling.controller.CityController">
		<property name="cityService" ref="cityService"/>
	</bean>


</beans>